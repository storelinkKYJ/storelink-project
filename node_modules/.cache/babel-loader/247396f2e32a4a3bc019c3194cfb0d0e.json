{"remainingRequest":"/Users/gim-yeongjae/Desktop/storelink3-admin/node_modules/babel-loader/lib/index.js!/Users/gim-yeongjae/Desktop/storelink3-admin/src/auth/authService.js","dependencies":[{"path":"/Users/gim-yeongjae/Desktop/storelink3-admin/src/auth/authService.js","mtime":1610509510802},{"path":"/Users/gim-yeongjae/Desktop/storelink3-admin/node_modules/cache-loader/dist/cjs.js","mtime":1610346344693},{"path":"/Users/gim-yeongjae/Desktop/storelink3-admin/node_modules/babel-loader/lib/index.js","mtime":1610344922456}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.reflect.construct\";\nimport \"core-js/modules/es6.string.sub\";\nimport \"core-js/modules/es6.function.name\";\nimport _classCallCheck from \"/Users/gim-yeongjae/Desktop/storelink3-admin/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/gim-yeongjae/Desktop/storelink3-admin/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/Users/gim-yeongjae/Desktop/storelink3-admin/node_modules/@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/gim-yeongjae/Desktop/storelink3-admin/node_modules/@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/gim-yeongjae/Desktop/storelink3-admin/node_modules/@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/gim-yeongjae/Desktop/storelink3-admin/node_modules/@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"/Users/gim-yeongjae/Desktop/storelink3-admin/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport auth0 from 'auth0-js';\nimport EventEmitter from 'events';\nimport authConfig from '@/../auth_config.json';\nimport store from '@/store/store.js'; // 'loggedIn' is used in other parts of application. So, Don't forget to change there also\n\nvar localStorageKey = 'loggedIn';\nvar tokenExpiryKey = 'tokenExpiry';\nvar loginEvent = 'loginEvent';\nvar webAuth = new auth0.WebAuth({\n  domain: authConfig.domain,\n  redirectUri: \"\".concat(window.location.origin + process.env.BASE_URL, \"callback\"),\n  clientID: authConfig.clientId,\n  responseType: 'id_token',\n  scope: 'openid profile email'\n});\n\nvar AuthService = /*#__PURE__*/function (_EventEmitter) {\n  _inherits(AuthService, _EventEmitter);\n\n  var _super = _createSuper(AuthService);\n\n  function AuthService() {\n    var _this;\n\n    _classCallCheck(this, AuthService);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"idToken\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"profile\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"tokenExpiry\", null);\n\n    return _this;\n  }\n\n  _createClass(AuthService, [{\n    key: \"login\",\n    // Starts the user login flow\n    value: function login(customState) {\n      webAuth.authorize({\n        appState: customState\n      });\n    } // Handles the callback request from Auth0\n\n  }, {\n    key: \"handleAuthentication\",\n    value: function handleAuthentication() {\n      var _this2 = this;\n\n      return new Promise(function (resolve, reject) {\n        webAuth.parseHash(function (err, authResult) {\n          if (err) {\n            alert(\"\".concat(err.error, \". Detailed error can be found in console.\"));\n            reject(err);\n          } else {\n            _this2.localLogin(authResult);\n\n            resolve(authResult.idToken);\n          }\n        });\n      });\n    }\n  }, {\n    key: \"localLogin\",\n    value: function localLogin(authResult) {\n      this.idToken = authResult.idToken;\n      this.profile = authResult.idTokenPayload; // Convert the JWT expiry time from seconds to milliseconds\n\n      this.tokenExpiry = new Date(this.profile.exp * 1000);\n      localStorage.setItem(tokenExpiryKey, this.tokenExpiry);\n      localStorage.setItem(localStorageKey, 'true');\n      store.commit('UPDATE_USER_INFO', {\n        displayName: this.profile.name,\n        email: this.profile.email,\n        photoURL: this.profile.picture,\n        providerId: this.profile.sub.substr(0, this.profile.sub.indexOf('|')),\n        uid: this.profile.sub\n      });\n      this.emit(loginEvent, {\n        loggedIn: true,\n        profile: authResult.idTokenPayload,\n        state: authResult.appState || {}\n      });\n    }\n  }, {\n    key: \"renewTokens\",\n    value: function renewTokens() {\n      var _this3 = this;\n\n      // reject can be used as parameter in promise for using reject\n      return new Promise(function (resolve) {\n        if (localStorage.getItem(localStorageKey) !== 'true') {// return reject(\"Not logged in\");\n        }\n\n        webAuth.checkSession({}, function (err, authResult) {\n          if (err) {// reject(err);\n          } else {\n            _this3.localLogin(authResult);\n\n            resolve(authResult);\n          }\n        });\n      });\n    }\n  }, {\n    key: \"logOut\",\n    value: function logOut() {\n      localStorage.removeItem(localStorageKey);\n      localStorage.removeItem(tokenExpiryKey);\n      localStorage.removeItem('userInfo');\n      this.idToken = null;\n      this.tokenExpiry = null;\n      this.profile = null;\n      webAuth.logout({\n        returnTo: window.location.origin + process.env.BASE_URL\n      });\n      this.emit(loginEvent, {\n        loggedIn: false\n      });\n    }\n  }, {\n    key: \"isAuthenticated\",\n    value: function isAuthenticated() {\n      return new Date(Date.now()) < new Date(localStorage.getItem(tokenExpiryKey)) && localStorage.getItem(localStorageKey) === 'true';\n    }\n  }]);\n\n  return AuthService;\n}(EventEmitter);\n\nexport default new AuthService();",{"version":3,"sources":["/Users/gim-yeongjae/Desktop/storelink3-admin/src/auth/authService.js"],"names":["auth0","EventEmitter","authConfig","store","localStorageKey","tokenExpiryKey","loginEvent","webAuth","WebAuth","domain","redirectUri","window","location","origin","process","env","BASE_URL","clientID","clientId","responseType","scope","AuthService","customState","authorize","appState","Promise","resolve","reject","parseHash","err","authResult","alert","error","localLogin","idToken","profile","idTokenPayload","tokenExpiry","Date","exp","localStorage","setItem","commit","displayName","name","email","photoURL","picture","providerId","sub","substr","indexOf","uid","emit","loggedIn","state","getItem","checkSession","removeItem","logout","returnTo","now"],"mappings":"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","sourcesContent":["import auth0 from 'auth0-js'\nimport EventEmitter from 'events'\nimport authConfig from '@/../auth_config.json'\n\nimport store from '@/store/store.js'\n\n// 'loggedIn' is used in other parts of application. So, Don't forget to change there also\nconst localStorageKey = 'loggedIn'\n\nconst tokenExpiryKey = 'tokenExpiry'\nconst loginEvent = 'loginEvent'\n\nconst webAuth = new auth0.WebAuth({\n  domain: authConfig.domain,\n  redirectUri: `${window.location.origin + process.env.BASE_URL}callback`,\n  clientID: authConfig.clientId,\n  responseType: 'id_token',\n  scope: 'openid profile email'\n})\n\nclass AuthService extends EventEmitter {\n    idToken = null;\n    profile = null;\n    tokenExpiry = null;\n\n    // Starts the user login flow\n    login (customState) {\n      webAuth.authorize({\n        appState: customState\n      })\n    }\n\n    // Handles the callback request from Auth0\n    handleAuthentication () {\n      return new Promise((resolve, reject) => {\n        webAuth.parseHash((err, authResult) => {\n          if (err) {\n            alert(`${err.error}. Detailed error can be found in console.`)\n            reject(err)\n          } else {\n            this.localLogin(authResult)\n            resolve(authResult.idToken)\n          }\n        })\n      })\n    }\n\n    localLogin (authResult) {\n      this.idToken = authResult.idToken\n      this.profile = authResult.idTokenPayload\n\n      // Convert the JWT expiry time from seconds to milliseconds\n      this.tokenExpiry = new Date(this.profile.exp * 1000)\n      localStorage.setItem(tokenExpiryKey, this.tokenExpiry)\n      localStorage.setItem(localStorageKey, 'true')\n\n      store.commit('UPDATE_USER_INFO', {\n        displayName: this.profile.name,\n        email: this.profile.email,\n        photoURL: this.profile.picture,\n        providerId: this.profile.sub.substr(0, this.profile.sub.indexOf('|')),\n        uid: this.profile.sub\n      })\n\n      this.emit(loginEvent, {\n        loggedIn: true,\n        profile: authResult.idTokenPayload,\n        state: authResult.appState || {}\n      })\n    }\n\n    renewTokens () {\n      // reject can be used as parameter in promise for using reject\n      return new Promise((resolve) => {\n        if (localStorage.getItem(localStorageKey) !== 'true') {\n          // return reject(\"Not logged in\");\n        }\n\n        webAuth.checkSession({}, (err, authResult) => {\n          if (err) {\n            // reject(err);\n          } else {\n            this.localLogin(authResult)\n            resolve(authResult)\n          }\n        })\n      })\n    }\n\n    logOut () {\n      localStorage.removeItem(localStorageKey)\n      localStorage.removeItem(tokenExpiryKey)\n      localStorage.removeItem('userInfo')\n\n      this.idToken = null\n      this.tokenExpiry = null\n      this.profile = null\n\n      webAuth.logout({\n        returnTo: window.location.origin + process.env.BASE_URL\n      })\n\n      this.emit(loginEvent, { loggedIn: false })\n    }\n\n    isAuthenticated () {\n      return (\n        new Date(Date.now()) < new Date(localStorage.getItem(tokenExpiryKey)) &&\n            localStorage.getItem(localStorageKey) === 'true'\n      )\n    }\n}\n\nexport default new AuthService()\n"]}]}